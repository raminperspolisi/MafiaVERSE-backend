<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ­ ØªØ³Øª Ø¨Ø§Ø²ÛŒ Ù…Ø§ÙÛŒØ§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .test-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }

        .status.connected {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4caf50;
        }

        .status.disconnected {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #f44336;
        }

        .status.connecting {
            background: rgba(255, 152, 0, 0.3);
            border: 1px solid #ff9800;
        }

        .player-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .player-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .log {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
        }

        .log-time {
            color: #ffd700;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ­ ØªØ³Øª Ø¨Ø§Ø²ÛŒ Ù…Ø§ÙÛŒØ§</h1>
            <p>Ø§ØªØ§Ù‚ ØªØ³Øª Ùˆ Ø¢Ø²Ù…Ø§ÛŒØ´</p>
        </div>

        <div class="test-section">
            <h3>ğŸ”— ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„</h3>
            <div id="connectionStatus" class="status connecting">Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...</div>
            <button class="btn" onclick="connect()">Ø§ØªØµØ§Ù„</button>
            <button class="btn" onclick="disconnect()">Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„</button>
        </div>

        <div class="test-section">
            <h3>ğŸ‘¥ Ø§ØªØ§Ù‚ Ø§Ù†ØªØ¸Ø§Ø±</h3>
            <button class="btn" onclick="joinWaitingRoom()">Ù¾ÛŒÙˆØ³ØªÙ† Ø¨Ù‡ Ø§ØªØ§Ù‚ Ø§Ù†ØªØ¸Ø§Ø±</button>
            <button class="btn" onclick="startGame()">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
            <div id="waitingPlayers" class="player-list"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ® ØªØ³Øª Ø¨Ø§Ø²ÛŒ</h3>
            <button class="btn" onclick="testVote()">ØªØ³Øª Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù†</button>
            <button class="btn" onclick="testMafiaAction()">ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§ÙÛŒØ§</button>
            <button class="btn" onclick="testDoctorAction()">ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ú©ØªØ±</button>
            <button class="btn" onclick="testDetectiveAction()">ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§Øª Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“ Ú¯Ø²Ø§Ø±Ø´ ØªØ³Øª</h3>
            <div id="testLog" class="log"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket;
        let isConnected = false;

        function updateConnectionStatus(status, message) {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.className = `status ${status}`;
            statusDiv.textContent = message;
        }

        function addLogEntry(message) {
            const log = document.getElementById('testLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const now = new Date();
            const time = now.getHours().toString().padStart(2, '0') + ':' + 
                        now.getMinutes().toString().padStart(2, '0') + ':' + 
                        now.getSeconds().toString().padStart(2, '0');
            
            entry.innerHTML = `
                <span class="log-time">${time}</span> - ${message}
            `;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function connect() {
            try {
                socket = io();
                
                socket.on('connect', () => {
                    isConnected = true;
                    updateConnectionStatus('connected', 'âœ… Ù…ØªØµÙ„ Ø¨Ù‡ Ø³Ø±ÙˆØ±');
                    addLogEntry('Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯');
                });
                
                socket.on('disconnect', () => {
                    isConnected = false;
                    updateConnectionStatus('disconnected', 'âŒ Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„');
                    addLogEntry('Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù‚Ø·Ø¹ Ø´Ø¯');
                });

                socket.on('waiting-players-updated', (players) => {
                    updateWaitingPlayers(players);
                    addLogEntry(`Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø§ØªØ§Ù‚ Ø§Ù†ØªØ¸Ø§Ø±: ${players.length} Ù†ÙØ±`);
                });

                socket.on('game-started', (gameData) => {
                    addLogEntry('ğŸ® Ø¨Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯!');
                    addLogEntry(`Ø´Ù†Ø§Ø³Ù‡ Ø¨Ø§Ø²ÛŒ: ${gameData.gameId}`);
                });

                socket.on('game-update', (gameData) => {
                    addLogEntry('ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¨Ø§Ø²ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯');
                });

                socket.on('error', (error) => {
                    addLogEntry(`âŒ Ø®Ø·Ø§: ${error}`);
                });

                updateConnectionStatus('connecting', 'Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...');
                
            } catch (error) {
                addLogEntry(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: ${error.message}`);
            }
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                isConnected = false;
                updateConnectionStatus('disconnected', 'âŒ Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„');
                addLogEntry('Ø§ØªØµØ§Ù„ Ù‚Ø·Ø¹ Ø´Ø¯');
            }
        }

        function joinWaitingRoom() {
            if (!isConnected) {
                addLogEntry('âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù…ØªØµÙ„ Ø´ÙˆÛŒØ¯');
                return;
            }

            const testUser = {
                userId: 'test-user-' + Date.now(),
                username: 'Ø¨Ø§Ø²ÛŒÚ©Ù† ØªØ³Øª ' + Math.floor(Math.random() * 1000),
                firstName: 'ØªØ³Øª',
                lastName: 'Ú©Ø§Ø±Ø¨Ø±'
            };
            
            socket.emit('join-waiting', testUser);
            addLogEntry(`ğŸ‘¤ Ù¾ÛŒÙˆØ³ØªÙ† Ø¨Ù‡ Ø§ØªØ§Ù‚ Ø§Ù†ØªØ¸Ø§Ø±: ${testUser.username}`);
        }

        function startGame() {
            if (!isConnected) {
                addLogEntry('âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù…ØªØµÙ„ Ø´ÙˆÛŒØ¯');
                return;
            }

            socket.emit('start-game');
            addLogEntry('ğŸš€ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
        }

        function updateWaitingPlayers(players) {
            const container = document.getElementById('waitingPlayers');
            container.innerHTML = '';
            
            players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-item';
                playerDiv.innerHTML = `
                    <div>ğŸ‘¤ ${player.username}</div>
                    <div style="font-size: 12px; color: #ccc;">${player.socketId}</div>
                `;
                container.appendChild(playerDiv);
            });
        }

        function testVote() {
            if (!isConnected) {
                addLogEntry('âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù…ØªØµÙ„ Ø´ÙˆÛŒØ¯');
                return;
            }

            const testVote = {
                targetPlayerId: 'test-target',
                gameId: 'test-game'
            };
            
            socket.emit('vote', testVote);
            addLogEntry('ğŸ—³ï¸ ØªØ³Øª Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù† Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
        }

        function testMafiaAction() {
            if (!isConnected) {
                addLogEntry('âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù…ØªØµÙ„ Ø´ÙˆÛŒØ¯');
                return;
            }

            const testAction = {
                targetPlayerId: 'test-target',
                gameId: 'test-game'
            };
            
            socket.emit('mafia-action', testAction);
            addLogEntry('ğŸ”ª ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§ÙÛŒØ§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
        }

        function testDoctorAction() {
            if (!isConnected) {
                addLogEntry('âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù…ØªØµÙ„ Ø´ÙˆÛŒØ¯');
                return;
            }

            const testAction = {
                targetPlayerId: 'test-target',
                gameId: 'test-game'
            };
            
            socket.emit('doctor-action', testAction);
            addLogEntry('ğŸ’Š ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ú©ØªØ± Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
        }

        function testDetectiveAction() {
            if (!isConnected) {
                addLogEntry('âŒ Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù…ØªØµÙ„ Ø´ÙˆÛŒØ¯');
                return;
            }

            const testAction = {
                targetPlayerId: 'test-target',
                gameId: 'test-game'
            };
            
            socket.emit('detective-action', testAction);
            addLogEntry('ğŸ” ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§Øª Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
        }

        // Auto-connect when page loads
        window.onload = function() {
            addLogEntry('ğŸ“± ØµÙØ­Ù‡ ØªØ³Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
            setTimeout(connect, 1000); // Connect after 1 second
        };
    </script>
</body>
</html> 