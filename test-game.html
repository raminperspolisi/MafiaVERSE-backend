<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎭 تست بازی مافیا</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .test-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }

        .status.connected {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4caf50;
        }

        .status.disconnected {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #f44336;
        }

        .status.connecting {
            background: rgba(255, 152, 0, 0.3);
            border: 1px solid #ff9800;
        }

        .player-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .player-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .log {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
        }

        .log-time {
            color: #ffd700;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎭 تست بازی مافیا</h1>
            <p>اتاق تست و آزمایش</p>
        </div>

        <div class="test-section">
            <h3>🔗 وضعیت اتصال</h3>
            <div id="connectionStatus" class="status connecting">در حال اتصال...</div>
            <button class="btn" onclick="connect()">اتصال</button>
            <button class="btn" onclick="disconnect()">قطع اتصال</button>
        </div>

        <div class="test-section">
            <h3>👥 اتاق انتظار</h3>
            <button class="btn" onclick="joinWaitingRoom()">پیوستن به اتاق انتظار</button>
            <button class="btn" onclick="startGame()">شروع بازی</button>
            <div id="waitingPlayers" class="player-list"></div>
        </div>

        <div class="test-section">
            <h3>🎮 تست بازی</h3>
            <button class="btn" onclick="testVote()">تست رای دادن</button>
            <button class="btn" onclick="testMafiaAction()">تست عملیات مافیا</button>
            <button class="btn" onclick="testDoctorAction()">تست عملیات دکتر</button>
            <button class="btn" onclick="testDetectiveAction()">تست عملیات کارآگاه</button>
        </div>

        <div class="test-section">
            <h3>📝 گزارش تست</h3>
            <div id="testLog" class="log"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket;
        let isConnected = false;

        function updateConnectionStatus(status, message) {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.className = `status ${status}`;
            statusDiv.textContent = message;
        }

        function addLogEntry(message) {
            const log = document.getElementById('testLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const now = new Date();
            const time = now.getHours().toString().padStart(2, '0') + ':' + 
                        now.getMinutes().toString().padStart(2, '0') + ':' + 
                        now.getSeconds().toString().padStart(2, '0');
            
            entry.innerHTML = `
                <span class="log-time">${time}</span> - ${message}
            `;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function connect() {
            try {
                socket = io();
                
                socket.on('connect', () => {
                    isConnected = true;
                    updateConnectionStatus('connected', '✅ متصل به سرور');
                    addLogEntry('اتصال به سرور برقرار شد');
                });
                
                socket.on('disconnect', () => {
                    isConnected = false;
                    updateConnectionStatus('disconnected', '❌ قطع اتصال');
                    addLogEntry('اتصال به سرور قطع شد');
                });

                socket.on('waiting-players-updated', (players) => {
                    updateWaitingPlayers(players);
                    addLogEntry(`بازیکنان اتاق انتظار: ${players.length} نفر`);
                });

                socket.on('game-started', (gameData) => {
                    addLogEntry('🎮 بازی شروع شد!');
                    addLogEntry(`شناسه بازی: ${gameData.gameId}`);
                });

                socket.on('game-update', (gameData) => {
                    addLogEntry('🔄 به‌روزرسانی بازی دریافت شد');
                });

                socket.on('error', (error) => {
                    addLogEntry(`❌ خطا: ${error}`);
                });

                updateConnectionStatus('connecting', 'در حال اتصال...');
                
            } catch (error) {
                addLogEntry(`❌ خطا در اتصال: ${error.message}`);
            }
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                isConnected = false;
                updateConnectionStatus('disconnected', '❌ قطع اتصال');
                addLogEntry('اتصال قطع شد');
            }
        }

        function joinWaitingRoom() {
            if (!isConnected) {
                addLogEntry('❌ ابتدا به سرور متصل شوید');
                return;
            }

            const testUser = {
                userId: 'test-user-' + Date.now(),
                username: 'بازیکن تست ' + Math.floor(Math.random() * 1000),
                firstName: 'تست',
                lastName: 'کاربر'
            };
            
            socket.emit('join-waiting', testUser);
            addLogEntry(`👤 پیوستن به اتاق انتظار: ${testUser.username}`);
        }

        function startGame() {
            if (!isConnected) {
                addLogEntry('❌ ابتدا به سرور متصل شوید');
                return;
            }

            socket.emit('start-game');
            addLogEntry('🚀 درخواست شروع بازی ارسال شد');
        }

        function updateWaitingPlayers(players) {
            const container = document.getElementById('waitingPlayers');
            container.innerHTML = '';
            
            players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-item';
                playerDiv.innerHTML = `
                    <div>👤 ${player.username}</div>
                    <div style="font-size: 12px; color: #ccc;">${player.socketId}</div>
                `;
                container.appendChild(playerDiv);
            });
        }

        function testVote() {
            if (!isConnected) {
                addLogEntry('❌ ابتدا به سرور متصل شوید');
                return;
            }

            const testVote = {
                targetPlayerId: 'test-target',
                gameId: 'test-game'
            };
            
            socket.emit('vote', testVote);
            addLogEntry('🗳️ تست رای دادن ارسال شد');
        }

        function testMafiaAction() {
            if (!isConnected) {
                addLogEntry('❌ ابتدا به سرور متصل شوید');
                return;
            }

            const testAction = {
                targetPlayerId: 'test-target',
                gameId: 'test-game'
            };
            
            socket.emit('mafia-action', testAction);
            addLogEntry('🔪 تست عملیات مافیا ارسال شد');
        }

        function testDoctorAction() {
            if (!isConnected) {
                addLogEntry('❌ ابتدا به سرور متصل شوید');
                return;
            }

            const testAction = {
                targetPlayerId: 'test-target',
                gameId: 'test-game'
            };
            
            socket.emit('doctor-action', testAction);
            addLogEntry('💊 تست عملیات دکتر ارسال شد');
        }

        function testDetectiveAction() {
            if (!isConnected) {
                addLogEntry('❌ ابتدا به سرور متصل شوید');
                return;
            }

            const testAction = {
                targetPlayerId: 'test-target',
                gameId: 'test-game'
            };
            
            socket.emit('detective-action', testAction);
            addLogEntry('🔍 تست عملیات کارآگاه ارسال شد');
        }

        // Auto-connect when page loads
        window.onload = function() {
            addLogEntry('📱 صفحه تست بارگذاری شد');
            setTimeout(connect, 1000); // Connect after 1 second
        };
    </script>
</body>
</html> 